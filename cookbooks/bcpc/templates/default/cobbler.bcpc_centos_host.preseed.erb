################################################
#
#              Generated by Chef
#
################################################

auth  --useshadow  --enablemd5
bootloader --location=mbr --driveorder=sda
cmdline
firewall --enabled
firstboot --disable
keyboard us
lang en_US
rootpw --iscrypted <%=get_config('cobbler-root-password-salted')%>
selinux --disabled
skipx
#timezone --utc
timezone UTC
install
reboot

<% if @node['bcpc']['bootstrap']['mirror'].nil? %>
# --proxy=http://@@server@@:3128
url --url=http://mirror.net.cen.ct.gov/centos/6/os/x86_64
repo --name="CT Centos Repo" --baseurl=http://mirror.net.cen.ct.gov/centos/6/os/x86_64 
repo --name="CT Centos Repo (Updates)" --baseurl=http://mirror.net.cen.ct.gov/centos/6/updates/x86_64 
<% else %>
url --url=http://<%= @node['bcpc']['bootstrap']['mirror'] %>/centos/6/os/x86_64
repo --name="Local Repo" --baseurl=http://<%= @node['bcpc']['bootstrap']['mirror'] %>/centos/6/os/x86_64
repo --name="Local Repo (Updates)" --baseurl=http://<%= @node['bcpc']['bootstrap']['mirror'] %>/centos/6/updates/x86_64
<% end %>
network --bootproto=dhcp --hostname=$system_name --device=eth0 --onboot=on

# LVM partition scheme
zerombr
clearpart --initlabel --drives=sda --all
part /boot --fstype=ext4 --size=200 --asprimary
part pv.00 --grow --asprimary --size=1
# Increased pesize from 4096 KB to 262144 KB (0.25GB) to allow bigger logvols
# Keep 10% of volgroup reserved for future use
volgroup vg_main --pesize=262144 pv.00 --reserved-percent=10
logvol swap --name=lv_swap --vgname=vg_main --size=256
# Allocate the rest to /
logvol / --fstype=ext4 --name=lv_root --vgname=vg_main --size=1 --grow

%pre
%end

%packages --nobase
@core
@server-policy
vim-enhanced
yum-utils
xorg-x11-xauth
xterm
sysstat
#firefox
openssh-clients
wget
%end

%post
wget "http://$http_server:$http_port/cblr/svc/op/nopxe/system/$system_name" -O /dev/null
%end
