#!/bin/bash
################################################
#
# Generated by Chef for <%= node.name %>
#
################################################
#
# This triggers populate_records() to populate records from records_all. If this
# doesn't run, the dynamic bits of DNS will get stale. The command is guarded by
# if_vip so that it is present on all head nodes should one go away, but it will
# only execute if the current node is the VIP.
#

if [ -n \"$(/usr/local/bin/if_vip echo Y)\" ] ; then
  /usr/local/bin/populate_dns.py -t 'ou=Tenants,<%= node['bcpc']['domain_name'].split('.').collect { |x| 'dc='+x }.join(',') %>' -v '<%= node['bcpc']['management']['vip'] %>' -u '<%= get_config('389ds-rootdn-user') %>' -p '<%= get_config('389ds-rootdn-password') %>' -U <%= get_config('mysql-pdns-user') %> -P '<%= get_config('mysql-pdns-password') %>' 2>&1 > /var/log/pdns_populate_records.last.log
fi
